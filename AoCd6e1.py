
map = """
.........................................#...............................#..........#.......................#.....................
................#.........................................#.................................#..........#...#......................
......................#...#............#..................#......................#.##........#............#.......................
...........................#...............................##.................#..............#............#.......................
..........#....#...............#.........#.................................#.......#.....................#..........#..........#..
..........................................#..............#...............................#.......................#................
.................#..#..........#.#..................#................................#.......#.#........#....#....#...............
.......#............#....................................#..#.....##...............................#........##...........#........
......#..................................................#.....#..................#......................................#........
....................................................................................................#...#.......#.............#...
.....#...................................................#...........#...##........##.................................#...........
........................#..........................#...............#.......#............#..#..........##..............#...........
.....................#...................................#.........................#..............#......#..................#.....
.........#.#....#.....#...................................#....................................#..................................
.........#.#......#.........................#............................................#...#...................................#
.........................................#.#...............................#..............#..............................#........
#...........#...................#.....#..................#.........#...#...................#.............................##.....#.
#....#..........#............#................................#...#............##.....#....................#......................
#.................................##...#........#..............#.......#..........#....................................#.........#
..............#...#...............................................#................#........#...#.................#......#........
..............#.....................#.....#...........#............#...#.......##.........................##.#....................
....#............................................##...................#.......................................#........#..........
.................................................................................#...#............................................
....................................#...................#.........#......#.....#...#.............................#..............#.
.....#................................#................................#........................................................#.
.............................................#..........##........#.........#..........................#..........................
...............#..#...........#.......#........................#.........#.....................................................##.
...#....................#.........................#..#............................#...........#..#...#...............#............
........#.....................................#.......................................................#...#..#.........#.#......#.
...........................................#...............#............................................................#.....#...
.........................................#.....#............##......................#..............................#..............
..#...............#.............................#............................#.........#.......#..................................
..............................................................................................................#.............#....#
..................#.#.............#......................................#.......#...............#..........#.....................
........................#.#.......#..........#...#......#.........#......#.................#........#.......#............#....#.#.
..#.....................................................................#......................#...............#..................
..................................................................#......#............................#........#........#.........
......................................#.....................#..................#..............#...................................
................#..#.....................................................#....................................#..........#........
...................................#........................................#.#..#............................................##..
...............................#.........................#..........................#............................#.........#......
............................#........#..............#.............#.#........................................................#....
................#..................#.....#......................#.....................................................#...........
......................#........#............#..................#...............#...............#..................................
......................................................#..................................................#........................
................#.......#..................................................................#......................................
....................................#....#...............#........................................................................
.................................................................................................#...#.#..........................
.......#..#...........#.....#...............................................................................#..............#......
...#.................#.................^...................#.....#................................................................
...............#.............................................................................#.................................#..
............................................#.....#............................................................#.#........##......
................................#................................#.......#..#......#...................#......#..............#....
...................##...........................................................#.................................................
...........................#...................#..........#...................................#............#.............#...#....
.....#........................#...............#..#.#.......#...................................#.##...............#...#...........
...#.....................#.#.......................#..........#.............................................................#.....
.......#.........................................#.........#.............#....................##...........................#......
.......................................##...........#.................#.......................................#..................#
................................#.......#..........................#........#.#........#..........#...........#....##.............
.......#............#....#....................................#.....#...............#.............................................
..........#.................#............................................................................#.............#....#...#.
...#.......................#.................................................................................................#....
.......................#....#..........................................................................................#..........
......................................................................#...............................#............#....#.........
.....#..............................................................................#............#...........................#....
..#.............#..#.............#...#............................................................................................
....................................................#.......#.............................#....#............#...................#.
....................................................................#.#...#....................................#..........#.......
......#...#................#.........#.................##......................#........................#.........................
.............#.#...........#..........................................................................#...........................
..........#.....#........#........................................................................#.#.................#...........
..........#.##....................................#......#................#..........#..........#.......##.....#..................
.............................#................................................................##.............#....................
....................................#.................................................................................###.........
..................................#..........#...................................#......#.........................................
...............#...........#.............................................#......#...................................#.............
...............#...#...................................................#...................#............#...................#.....
........................................#......#.............#........#..........................#....#.....#..................#..
.......................#......................................................................#.......#...................#.....##
.................#.....................#............#............................#..........#......................#..............
....................#................................................................#................#......#.#..................
.#............#...............................................#..#......##.#................................##....#...............
.#.......#..........................................................................................................#.............
.................#............#...............................................................................#...................
.................................##......................................#.........................#................#.............
...................#.............................................................#................................................
...#.....#..#......#........#....#.................#..................#..#......................................#...........#...#.
.#.....................#...........................................................................#............................#.
.#............................#.........#...............................................#.........................................
....#......................#......................#....#........#.....#...................................#......................#
.......#.................#..............................#.....#......................#...............#..............#.......#.....
...#.................................................................................................#........#.....#......#......
......##...................................................................................#................................#.....
..........#................................#..................................#.................................................#.
...........#........#..............#...#..............#...................................................#......#.........#......
.......#...#....................................#..##.........................................................#...................
...........#............................................##..........#..#.#.....................................................#..
...................................#............................#..............#..#..................................#............
....#.......#...............#...........................................................................#.........................
...............#.....................................................................................................#............
................#..........................................#...............##...........................#....#..........#.........
...........................................#...................................................................................#..
.................#..........................................................................#.....#.............##..........#.....
...............#..................#................................#.......................#...#.....##...........................
.............#.......................#.......#.............#.#...#......#..............#.............................#.#..........
..........##....#..#..............................#...............................................................................
.................#......#.......#.....#..........#.............................#......................#.....#.....................
....#........#....................#.#.........#.#..........#......................................................................
...........................#.......#........#.........................#.#.................#........#...............#......#.......
#..#..................#...........#.....................................................................................#.........
......#...#.#...........#.....................................................#................#..#............#..................
................##.#...#..............#..............................#............................................................
...........................................................................................#.............................#........
.......#....#...................#..........................................................#............#............#.....#......
.............#....#..................................#....#........#.....................................#.#....#..............#.#
.#..................................................#...................#...............#.........................................
...#........#..................................#............#.#.......................................#...........................
................#.....#....................................#.#.#...........#......##................#.................#......#....
...#.......................#...........#...#...........#.#........................#..#.................##.....#...................
.............#.......................................#................#....#..#..#.....................#...#............#.........
..........#..................#............#...#..................#................................................................
.........#..........#.....................#..#................#.......................#.........#.......##..#.#....#.....#....#...
#..........................#.#...........#.#.........#............................................................................
..................#.....................#......#.##...................#................................................#..#.......
.....#....#......#..#............................##.........................................................#.....#.......#...##..
....#...#.#...##..................#..........................................................#.....#..............................
..............................#............#...........#..................................#....#............#.......#.............
....................................#.....................#............................#..............#...........................
............#............#..........#....##....................................#..#.....#..................#......................
"""

test_map = """
....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...
"""

map_bounds = None
obstacles = set()
guard_pos = None
guard_dir = None

def load_map(map):
	for y, line in enumerate(map.strip().splitlines()):
		for x, tile in enumerate(line):
			global guard_pos, guard_dir
			if tile == '#':
				global obstacles
				obstacles.add((x, y))
			elif tile == '^':
				guard_pos = [x, y]
				guard_dir = 0
			elif tile == '>':
				guard_pos = [x, y]
				guard_dir = 1
			elif tile == 'v':
				guard_pos = [x, y]
				guard_dir = 2
			elif tile == '<':
				guard_pos = [x, y]
				guard_dir = 3
	global map_bounds
	map_bounds = (x, y)

def calc_guard_path():
	path = set()
	global guard_pos
	while 0 <= guard_pos[0] <= map_bounds[0] and 0 <= guard_pos[1] <= map_bounds[1]:
		global guard_dir
		path.add((guard_pos[0], guard_pos[1]))
			
		if guard_dir == 0:
			if (guard_pos[0], guard_pos[1] - 1) in obstacles:
				guard_dir = (guard_dir + 1) % 4
		elif guard_dir == 1:
			if (guard_pos[0] + 1, guard_pos[1]) in obstacles:
				guard_dir = (guard_dir + 1) % 4
		elif guard_dir == 2:
			if (guard_pos[0], guard_pos[1] + 1) in obstacles:
				guard_dir = (guard_dir + 1) % 4
		elif guard_dir == 3:
			if (guard_pos[0] - 1, guard_pos[1]) in obstacles:
				guard_dir = (guard_dir + 1) % 4
		else:
			raise ValueError('Incorrect state')
		
		if guard_dir == 0:
			guard_pos[1] -= 1
		elif guard_dir == 1:
			guard_pos[0] += 1
		elif guard_dir == 2:
			guard_pos[1] += 1
		elif guard_dir == 3:
			guard_pos[0] -= 1
		else:
			raise ValueError('Incorrect state')
		
	return path

load_map(test_map)

path = calc_guard_path()

print(len(path))
